{"version":3,"sources":["webpack:///webpack/bootstrap 693258abea5273a1c967","webpack:///./src/js/index.js","webpack:///./src/js/doppler.js","webpack:///./src/js/doppler.js?9ea2"],"names":[],"mappings":"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","file":"doppler.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/public/js\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 693258abea5273a1c967\n **/","import Doppler from './doppler';\n\n$(($) => {\n\n    let $box = $('#box'),\n        doppler = new Doppler();\n\n    (new Doppler).init((bandwidth) => {\n        var threshold = 4;\n        \n        // console.log('Bandwidth: ', bandwidth.left, 'x', bandwidth.right);\n\n        if (bandwidth.left > threshold || bandwidth.right > threshold) {\n            let scale    = 10,\n                baseSize = 100,\n                diff = bandwidth.left - bandwidth.right,\n                dimension = (baseSize + scale * diff);\n\n            $box.css({\n                width: dimension,\n                height: dimension\n            });\n        }\n    });\n});\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/index.js\n **/","const {\n    requestAnimationFrame,\n    cancelAnimationFrame,\n    setTimeout,\n    navigator\n} = window;\n\nexport default class {\n\n    constructor(...callbacks) {\n        const AudioContext = (\n            window.AudioContext\n            || window.webkitAudioContext\n            || window.mozAudioContext\n            || window.oAudioContext\n            || window.msAudioContext\n        );\n\n        this.audioCtx = new AudioContext();\n        this.oscillator = this.audioCtx.createOscillator();\n        this.freq = 20000;\n        this.relevantFreqWindow = 33;\n        this.nyquist = this.audioCtx.sampleRate / 2;\n\n        this.readMicInterval = 0;\n\n        this.callbacks = callbacks;\n    }\n\n    pushToCallbacks(...args) {\n        callbacks.each((callback) => callback(args));\n    }\n\n    getBandwidth (analyser, freqs) {\n        const primaryTone = this.freqToIndex(analyser, this.freq),\n              primaryVolume = freqs[primaryTone],\n              maxVolumeRatio = 0.001;\n\n        let leftBandwidth = 0,\n            rightBandwidth = 0,\n            volume,\n            normalizedVolume;\n\n        do {\n            leftBandwidth++;\n            volume = freqs[primaryTone-leftBandwidth];\n            normalizedVolume = volume / primaryVolume;\n        } while (normalizedVolume > maxVolumeRatio && leftBandwidth < this.relevantFreqWindow);\n\n        do {\n            rightBandwidth++;\n            volume = freqs[primaryTone+rightBandwidth];\n            normalizedVolume = volume / primaryVolume;\n        } while (normalizedVolume > maxVolumeRatio && rightBandwidth < this.relevantFreqWindow);\n\n        return {\n            left: leftBandwidth,\n            right: rightBandwidth\n        };\n    }\n    \n    freqToIndex (analyser, freq) {\n        return Math.round(\n            freq / this.nyquist * analyser.fftSize / 2\n        );\n    }\n    \n    indexToFreq (analyser, index) {\n        return this.nyquist / (analyser.fftSize / 2) * index;\n    }\n    \n    optimizeFrequency (oscillator, analyser, freqSweepStart, freqSweepEnd) {\n        let oldFreq = oscillator.frequency.value,\n            audioData = new Uint8Array(analyser.frequencyBinCount),\n            maxAmp = 0,\n            maxAmpIndex = 0,\n            from = this.freqToIndex(analyser, freqSweepStart),\n            to   = this.freqToIndex(analyser, freqSweepEnd);\n    \n        for (var i = from; i < to; i++) {\n            oscillator.frequency.value = this.indexToFreq(analyser, i);\n            analyser.getByteFrequencyData(audioData);\n    \n            if (audioData[i] > maxAmp) {\n                maxAmp = audioData[i];\n                maxAmpIndex = i;\n            }\n        }\n        // Sometimes the above procedure seems to fail, not sure why.\n        // If that happends, just use the old value.\n        if (maxAmpIndex == 0) {\n            return oldFreq;\n        }\n        else {\n            return this.indexToFreq(analyser, maxAmpIndex);\n        }\n    }\n    \n    readMic (analyser, userCallback) {\n        let audioData = new Uint8Array(analyser.frequencyBinCount);\n\n        analyser.getByteFrequencyData(audioData);\n\n        let primaryTone = this.freqToIndex(analyser, this.freq);\n\n        this.pushToCallbacks({\n            type: 'TYPE_1',\n            payload: {\n                primaryTone: primaryTone,\n                index: this.freqToIndex(analyser, 22000),\n                analyser,\n                audioData\n            }\n        });\n\n        this.pushToCallbacks({\n            type: 'TYPE_2',\n            payload: {\n                primaryTone: primaryTone,\n                to: primaryTone - this.relevantFreqWindow,\n                from: primaryTone + this.relevantFreqWindow,\n                analyser,\n                audioData\n            }\n        });\n        \n        let band = this.getBandwidth(analyser, audioData);\n        userCallback(band);\n\n        this.pushToCallbacks({\n            type: 'TYPE_3',\n            payload: {\n                bandDiff: band[0] - band[1]\n            }\n        });\n    \n        this.readMicInterval = requestAnimationFrame(this.readMic.bind(this, analyser, userCallback));\n    \n        return this.readMicInterval;\n    }\n    \n    handleMic (stream, callback, userCallback) {\n    \n        let mic = this.audioCtx.createMediaStreamSource(stream),\n            analyser = this.audioCtx.createAnalyser();\n    \n        analyser.smoothingTimeConstant = 0.5;\n        analyser.fftSize = 2048;\n    \n        mic.connect(analyser);\n    \n        // Doppler tone\n        this.oscillator.frequency.value = this.freq;\n        this.oscillator.type = this.oscillator.SINE;\n        this.oscillator.start(0);\n        this.oscillator.connect(this.audioCtx.destination);\n    \n        // There seems to be some initial \"warm-up\" period\n        // where all frequencies are significantly louder.\n        // A quick timeout will hopefully decrease that bias effect.\n        setTimeout(() => {\n            // Optimize doppler tone\n            let freq = this.optimizeFrequency(this.oscillator, analyser, 19000, 22000);\n    \n            this.oscillator.frequency.value = freq;\n    \n            callback(analyser, userCallback);\n        });\n    }\n    \n    init(callback) {\n    \n        let options = {\n            audio: {\n                optional: [\n                    {\n                        echoCancellation: false\n                    }\n                ]\n            }\n        };\n    \n        navigator.mediaDevices\n            .getUserMedia(options)\n            .then((stream) => this.handleMic(stream, this.readMic.bind(this), callback))\n            .catch(() => console.log('Error!'));\n    }\n    \n    stop() {\n        cancelAnimationFrame(this.readMicInterval);\n    }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/doppler.js\n **/","module.exports = global[\"Dopler\"] = require(\"-!/home/savks/Work/left/defmove/node_modules/babel-loader/index.js?{\\\"presets\\\":[\\\"es2015\\\",\\\"stage-0\\\"]}!/home/savks/Work/left/defmove/src/js/doppler.js\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/doppler.js\n ** module id = 2\n ** module chunks = 0\n **/"],"sourceRoot":""}